diff -Naur linux/drivers/mtd/concat/mtd-concat.c linux_new/drivers/mtd/concat/mtd-concat.c
--- linux/drivers/mtd/concat/mtd-concat.c	2021-02-23 22:37:44.526405273 +0530
+++ linux_new/drivers/mtd/concat/mtd-concat.c	2021-02-23 23:36:03.653613273 +0530
@@ -16,6 +16,9 @@
 #include <linux/of_platform.h>
 #include <linux/slab.h>
 
+#ifdef CONFIG_SPX_FEATURE_HW_FAILSAFE_BOOT
+extern unsigned char broken_spi_banks;
+#endif
 /*
  * struct of_mtd_concat - platform device driver data.
  * @cmtd the final mtd_concat device
@@ -94,6 +97,24 @@
                info->devices[info->num_devices++] = mtd;
        }
 
+#ifdef CONFIG_SPX_FEATURE_HW_FAILSAFE_BOOT
+	broken_spi_banks=0;
+	if(strstr(boot_command_line,"imagebooted=1")) {
+		if(info->num_devices == 1) {
+			broken_spi_banks=2;//second spi not detected
+			printk("SPI 2 not Detected\n");
+		}
+	}
+	else if(strstr(boot_command_line,"imagebooted=2")) {
+		if(info->num_devices == 1) {
+			broken_spi_banks=1;//first spi not detected
+			printk("SPI 1 not Detected\n");
+		}
+	}
+	else {
+		broken_spi_banks=0;
+	}
+#endif
        info->cmtd = mtd_concat_create(info->devices, info->num_devices,
                                       dev_name(&pdev->dev));
        if (!info->cmtd) {
